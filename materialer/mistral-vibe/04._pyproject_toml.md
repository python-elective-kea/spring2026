# Understanding and Using pyproject.toml

## **What is pyproject.toml?**

`pyproject.toml` is the modern standard for Python project configuration. It replaces older files like `setup.py`, `setup.cfg`, and `requirements.txt` with a single, standardized configuration file.

### **Key Benefits:**
- **Standardized**: Defined in [PEP 518](https://peps.python.org/pep-0518/) and [PEP 621](https://peps.python.org/pep-0621/)
- **Declarative**: Simple key-value configuration instead of Python code
- **Tool-agnostic**: Works with pip, uv, poetry, and other modern tools
- **Comprehensive**: Handles dependencies, build system, project metadata, and tool configurations
- **UV Optimized**: Works seamlessly with UV for blazing-fast dependency resolution and builds

--- 

## **Basic Structure of pyproject.toml**

A typical `pyproject.toml` file contains several sections:

```toml
[build-system]
# Build backend configuration
requires = ["hatchling", "hatch-vcs"]
build-backend = "hatchling.build"

[project]
# Project metadata
name = "your-package"
version = "0.1.0"
description = "Your package description"
authors = [{name = "Your Name", email = "you@example.com"}]
readme = "README.md"
requires-python = ">=3.8"
license = {text = "MIT"}

# Dependencies
dependencies = [
    "requests>=2.31.0",
    "numpy>=1.24.0",
]

[project.optional-dependencies]
# Optional/extra dependencies
test = ["pytest>=7.0", "pytest-cov"]
dev = ["black", "ruff", "mypy"]

[tool.hatch.build.targets.wheel]
# Build configuration
packages = ["src/your_package"]

[tool.hatch.envs.default]
# Environment-specific dependencies
dependencies = [
    "pytest",
    "pytest-cov",
]

[tool.black]
# Tool-specific configuration
line-length = 88

[tool.ruff]
# Another tool configuration
line-length = 88
select = ["E", "F", "W", "I"]
```

--- 

## **How to Use pyproject.toml**

### **1. Creating a New Project**

Create a new directory and initialize a basic `pyproject.toml` file:

```bash
mkdir my_project
cd my_project
# Create a basic pyproject.toml file
touch pyproject.toml
```

**With UV (recommended for fast setup):**
```bash
uv venv .venv          # Create virtual environment
source .venv/bin/activate  # Activate it
uv pip install -e .    # Install your package in editable mode
```

### **2. Adding Dependencies**

Edit the `[project.dependencies]` section:

```toml
[project]
dependencies = [
    "requests>=2.31.0",
    "numpy>=1.24.0",
    "pandas>=2.0.0",
]
```

### **3. Adding Optional Dependencies**

Use `[project.optional-dependencies]` for extras:

```toml
[project.optional-dependencies]
test = ["pytest>=7.0", "pytest-cov"]
dev = ["black", "ruff", "mypy"]
docs = ["mkdocs", "mkdocs-material"]
```

Install with:
```bash
pip install your-package[test,dev]
```

### **4. Installing Your Package**

In development (editable mode) with UV:
```bash
uv pip install -e .
```

With traditional pip:
```bash
pip install -e .
```

### **5. Building Your Package**

With UV (recommended for speed):
```bash
uv build  # Fast building using pyproject.toml
```

With traditional build:
```bash
python -m build  # Uses pyproject.toml automatically
```

### **6. Publishing to PyPI**

With UV (fast workflow):
```bash
uv build          # Fast building
uv publish        # Direct publishing (requires PyPI credentials)
```

Traditional workflow:
```bash
# Build first
python -m build

# Then publish
twine upload dist/*
```

--- 

## **Common Sections Explained**

### **[build-system]**
- Defines what tools are needed to build your package
- `requires`: Build-time dependencies
- `build-backend`: The build system (hatchling, setuptools, poetry, etc.)

### **[project]**
- Core project metadata (name, version, description, etc.)
- `dependencies`: Required packages for your project
- `optional-dependencies`: Extra dependency groups
- `requires-python`: Minimum Python version

### **[tool.*]**
- Tool-specific configurations
- Examples: `[tool.black]`, `[tool.ruff]`, `[tool.pytest.ini_options]`
- Each tool reads its own section

### **[tool.setuptools]** (or other build backends)
- Build backend-specific configurations
- Package discovery, build options, etc.

--- 

## **Best Practices**

1. **Version Specifiers**: Use careful version pinning
   - `>=1.2.0,<2.0.0` for major version compatibility
   - `~=1.2.0` for patch updates only

2. **Organize Dependencies**: Group related dependencies together

3. **Use Optional Dependencies**: For development, testing, and optional features

4. **Keep it Updated**: Regularly update your dependencies

5. **Document Your Config**: Add comments explaining non-obvious choices

--- 

## **Migrating from requirements.txt**

Convert your `requirements.txt` to `pyproject.toml`:

**Before (requirements.txt):**
```
requests>=2.31.0
numpy>=1.24.0
pytest>=7.0
```

**After (pyproject.toml):**
```toml
[project]
dependencies = [
    "requests>=2.31.0",
    "numpy>=1.24.0",
]

[project.optional-dependencies]
test = ["pytest>=7.0"]
```

--- 

## **Tools That Use pyproject.toml**

- **Package Managers**: pip, uv, poetry
- **Build Tools**: setuptools, flit, pdm
- **Fast Build Tools**: uv (recommended for speed)
- **Linters/Formatters**: black, ruff, mypy
- **Testing**: pytest, coverage
- **Documentation**: mkdocs, sphinx
- **CI/CD**: tox, nox

--- 

## **Example: Complete pyproject.toml**

```toml
[build-system]
requires = ["setuptools>=61.0.0"]
build-backend = "setuptools.build_meta"

# For UV compatibility (optional but recommended):
# requires = ["setuptools>=61.0.0", "wheel"]
# build-backend = "setuptools.build_meta"

[project]
name = "example-package"
version = "0.1.0"
description = "An example Python package"
readme = "README.md"
requires-python = ">=3.8"
license = "MIT"
keywords = ["example", "package"]
authors = [
    {name = "Your Name", email = "you@example.com"},
]
classifiers = [
    "Development Status :: 4 - Beta",
    "Programming Language :: Python :: 3",
    "License :: OSI Approved :: MIT License",
]

dependencies = [
    "requests>=2.31.0",
    "numpy>=1.24.0",
]

[project.optional-dependencies]
test = ["pytest>=7.0", "pytest-cov"]
dev = ["black", "ruff", "mypy", "pre-commit"]
docs = ["mkdocs", "mkdocs-material"]

[project.urls]
Homepage = "https://github.com/yourname/example-package"
Documentation = "https://yourname.github.io/example-package"
Repository = "https://github.com/yourname/example-package"
Issues = "https://github.com/yourname/example-package/issues"

[tool.setuptools.packages.find]
where = ["src"]

[tool.black]
line-length = 88
target-version = ["py38", "py39", "py310", "py311"]

[tool.ruff]
line-length = 88
select = ["E", "F", "W", "I", "B", "C4", "UP"]
ignore = ["E501"]

[tool.mypy]
python_version = "3.8"
warn_return_any = true
warn_unused_configs = true
```

--- 

## **Resources**

- [PEP 518 - Specifying Minimum Build System Requirements](https://peps.python.org/pep-0518/)
- [PEP 621 - Storing project metadata in pyproject.toml](https://peps.python.org/pep-0621/)
- [Python Packaging User Guide](https://packaging.python.org/en/latest/specifications/pyproject-toml/)
- [Poetry Documentation](https://python-poetry.org/docs/pyproject/)
- [Setuptools Documentation](https://setuptools.pypa.io/en/latest/userguide/pyproject_config.html)